
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Production environment &#8212; Site Reliability Guide for mybinder.org 1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Terminology for the deployment" href="terminology.html" />
    <link rel="prev" title="Getting started with the mybinder.org dev team" href="getting_started.html" />

   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

<!-- Add JupyterHub styling -->
<link rel="stylesheet" href="_static/jupyter.css" type="text/css" />
<link rel="shortcut icon" href="_static/favicon.ico"/>


  </head><body>
<div class="rightsidebar">
    <h3>On this page</h3>
    <ul>
<li><a class="reference internal" href="#">Production environment</a><ul>
<li><a class="reference internal" href="#repository-structure">Repository structure</a></li>
<li><a class="reference internal" href="#dependent-charts">Dependent charts</a></li>
<li><a class="reference internal" href="#configuration-values">Configuration values</a></li>
<li><a class="reference internal" href="#deployment-nodes-and-pools">Deployment nodes and pools</a></li>
<li><a class="reference internal" href="#mybinder-org-specific-extra-software">mybinder.org specific extra software</a></li>
<li><a class="reference internal" href="#related-repositories">Related repositories</a></li>
<li><a class="reference internal" href="#the-deployment-helm-meta-chart">The Deployment Helm Meta Chart</a></li>
<li><a class="reference internal" href="#https-configuration-for-mybinder-org">HTTPS configuration for <code class="docutils literal notranslate"><span class="pre">mybinder.org</span></code></a><ul>
<li><a class="reference internal" href="#exceptions-on-the-ovh-cluster">Exceptions on the OVH cluster</a></li>
</ul>
</li>
<li><a class="reference internal" href="#secrets">Secrets</a><ul>
<li><a class="reference internal" href="#sharing-secrets">Sharing secrets</a></li>
<li><a class="reference internal" href="#who-has-the-keys">Who has the keys?</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
   <div class='prev-next-top'>
     
      <a class='left-prev' href="getting_started.html" title="previous chapter">Previous</a>
      <a class='right-next' href="terminology.html" title="next chapter">Next</a>
   <div style='clear:both;'></div>
 
   </div>


          <div class="body" role="main">
            
  <div class="section" id="production-environment">
<span id="production-environment"></span><h1>Production environment<a class="headerlink" href="#production-environment" title="Permalink to this headline">¶</a></h1>
<p>This section is an overview of the repositories, projects, and
systems used in a mybinder.org production deployment.</p>
<p>Reference: <a class="reference external" href="https://landing.google.com/sre/book/chapters/production-environment.html">Google SRE book section on Production Environment</a></p>
<div class="section" id="repository-structure">
<span id="repository-structure"></span><h2>Repository structure<a class="headerlink" href="#repository-structure" title="Permalink to this headline">¶</a></h2>
<p>This repository contains a ‘meta chart’ (<code class="docutils literal notranslate"><span class="pre">mybinder</span></code>) that fully captures the
state of the deployment on mybinder.org. Since it is a full helm chart, you
can read the <a class="reference external" href="https://docs.helm.sh/developing_charts/#the-chart-file-structure">official helm chart structure</a>
document to know more about its structure.</p>
</div>
<div class="section" id="dependent-charts">
<span id="dependent-charts"></span><h2>Dependent charts<a class="headerlink" href="#dependent-charts" title="Permalink to this headline">¶</a></h2>
<p>The core of the meta-chart pattern is to install a bunch of <a class="reference external" href="https://docs.helm.sh/developing_charts/#chart-dependencies">dependent charts</a>,
specified in <code class="docutils literal notranslate"><span class="pre">mybinder/requirements.yaml</span></code>. This contains both support
charts like nginx-ingress &amp; kube-lego, but also the core application chart
<code class="docutils literal notranslate"><span class="pre">binderhub</span></code>. Everything is version pinned here.</p>
</div>
<div class="section" id="configuration-values">
<span id="configuration-values"></span><h2>Configuration values<a class="headerlink" href="#configuration-values" title="Permalink to this headline">¶</a></h2>
<p>The following files fully capture the state of the deployment for staging:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mybinder/values.yaml</span></code> - Common configuration values between prod &amp;
staging</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret/config/staging.yaml</span></code> - Secret values specific to the staging
deployment</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">config/staging.yaml</span></code> - Non-secret values specific to the staging
deployment</p></li>
</ol>
<p>The following files fully capture the state of the production deployment:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mybinder/values.yaml</span></code> - Common configuration values between prod &amp;
staging</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">secret/config/prod.yaml</span></code> - Secret values specific to the production
deployment</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">config/prod.yaml</span></code> - Non-secret values specific to the production
deployment</p></li>
</ol>
<p><strong>Important</strong>: For maintainability and consistency, we try to keep the contents
of <code class="docutils literal notranslate"><span class="pre">staging.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">prod.yaml</span></code> super minimal - they should be as close
to each other as possible. We want all common config in <code class="docutils literal notranslate"><span class="pre">values.yaml</span></code> so testing
on staging gives us confidence it will work on prod. We also never share the same
secrets between staging &amp; prod for security boundary reasons.</p>
</div>
<div class="section" id="deployment-nodes-and-pools">
<span id="deployment-nodes-and-pools"></span><h2>Deployment nodes and pools<a class="headerlink" href="#deployment-nodes-and-pools" title="Permalink to this headline">¶</a></h2>
<p>The staging cluster has one node pool, which makes things simple.
The production cluster has two, one for “core” pods (the hub, etc.)
and another dedicated to “user” pods (builds and user servers).
This strategy helps protect our key services from potential issues caused by users and helps us drain user nodes when we need to.</p>
<p>Since ~only user pods should be running on the user nodes,
cordoning that node should result in it being drained and reclaimed
after the max-pod-age lifetime limit
which often wouldn’t happen without manual intervention.</p>
<p>It is still <em>not quite true</em> that only user pods are running on the user nodes at this point.
There can be some pods such as heapster and kube-dns that may run on user nodes,
and need to be manually removed from the pod after cordoning before the autoscaler will allow culling.</p>
<p>In the future, when we implement a pod packing strategy and node taints,
nodes could get reclaimed truly automatically without any intervention,
but we are not there yet.</p>
<p>Users and core pods are assigned to their pools via a <code class="docutils literal notranslate"><span class="pre">nodeSelector</span></code> in <code class="docutils literal notranslate"><span class="pre">config/prod.yaml</span></code>.
We use a custom label <code class="docutils literal notranslate"><span class="pre">mybinder.org/node-purpose</span> <span class="pre">=</span> <span class="pre">core</span> <span class="pre">|</span> <span class="pre">user</span></code>
to select which node a pod should run on.</p>
</div>
<div class="section" id="mybinder-org-specific-extra-software">
<span id="mybinder-org-specific-extra-software"></span><h2>mybinder.org specific extra software<a class="headerlink" href="#mybinder-org-specific-extra-software" title="Permalink to this headline">¶</a></h2>
<p>We sometimes want to run additional software for the mybinder deployment that
does not already have a chart, or would be too cumbersome to use with a chart.
For those cases, we can create kubernetes objects directly from the <code class="docutils literal notranslate"><span class="pre">mybinder</span></code>
meta chart. You can see an example of this under <code class="docutils literal notranslate"><span class="pre">mybinder/templates/redirector</span></code>
that is used to set up a simple nginx based HTTP redirector.</p>
</div>
<div class="section" id="related-repositories">
<span id="related-repositories"></span><h2>Related repositories<a class="headerlink" href="#related-repositories" title="Permalink to this headline">¶</a></h2>
<p>Related repositories used by the <a class="reference external" href="https://mybinder.org">mybinder.org</a> service are:</p>
<ol>
<li><p><a class="reference external" href="https://github.com/jupyterhub/binderhub">binderhub</a></p>
<p>This contains the <a class="reference external" href="https://github.com/jupyterhub/binderhub">binderhub</a> code (UI &amp; hub management) &amp; helm chart.
To change the UI / UX or hub management aspects of <a class="reference external" href="https://mybinder.org">mybinder.org</a>,
go to <a class="reference external" href="https://github.com/jupyterhub/binderhub">binderhub</a>.</p>
</li>
<li><p><a class="reference external" href="https://github.com/jupyter/repo2docker">repo2docker</a></p>
<p>This is used to do the actual building of git repositories into docker
images, and can be used standalone too. If you want to change how a git
repository is converted into a docker image to be run for the user,
go to <a class="reference external" href="https://github.com/jupyter/repo2docker">repo2docker</a>.</p>
</li>
</ol>
</div>
<div class="section" id="the-deployment-helm-meta-chart">
<span id="the-deployment-helm-meta-chart"></span><h2>The Deployment Helm Meta Chart<a class="headerlink" href="#the-deployment-helm-meta-chart" title="Permalink to this headline">¶</a></h2>
<p>BinderHub is deployed using a Kubernetes Helm Chart, which is a specification
for instructing Kubernetes how to deploy particular applications. Sometimes,
applications depend on others in order to function properly, similar to how
a package might depend on other packages (e.g., Pandas depends on Numpy).
These dependencies are specified with a Helm “Meta Chart”.</p>
<p>For example, let’s say that you’d like to begin using Prometheus in your
Kubernetes deployment. Since Prometheus has a helm chart for deploying it
on Kubernetes, we can add it as a dependency in a Helm Meta Chart. We’d
create a file called <code class="docutils literal notranslate"><span class="pre">requirements.yaml</span></code> and put the following in it:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dependencies</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
  <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4.6.16</span>
  <span class="nt">repository</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://kubernetes-charts.storage.googleapis.com</span>
</pre></div>
</div>
<p>This also allows us to pin a <em>version</em> of Prometheus, which improves
reliability of the site.</p>
<div class="highlight-note:: notranslate"><div class="highlight"><pre><span></span>It is still possible to deploy each of these applications on their own *without*
a Meta Helm Chart, this is simply a way of clustering dependencies together
and simplifying the deployment structure.
</pre></div>
</div>
<p>Another benefit of Meta Charts is that you can use a single configuration
file (<code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>) with multiple Helm Charts. For example, look at the
<a class="reference external" href="https://github.com/jupyterhub/mybinder.org-deploy/blob/staging/mybinder/values.yaml">BinderHub Helm Chart</a>. Note that there are multiple
top-level sections (e.g., for <a class="reference external" href="https://github.com/jupyterhub/mybinder.org-deploy/blob/5aa6dde60c9b5f3012686f9ba2b23b176c19b224/mybinder/values.yaml#L53">jupyterhub</a> and for <a class="reference external" href="https://github.com/jupyterhub/mybinder.org-deploy/blob/5aa6dde60c9b5f3012686f9ba2b23b176c19b224/mybinder/values.yaml#L204">prometheus</a>) and that each section
has a corresponding entry in the Helm Meta Chart. In this way, we can provide
configuration for each dependency of BinderHub without needing a separate
file for each, and we can deploy them all at the same time.</p>
<p>For more information, we recommend investigating the structure of the
<a class="reference external" href="https://github.com/jupyterhub/mybinder.org-deploy/blob/staging/mybinder/requirements.yaml">Binder Helm Meta Chart</a>. In addition, the Kubernetes
organization keeps a <a class="reference external" href="https://github.com/kubernetes/charts">curated list of Helm Charts</a> that you can specify in
your Meta Chart in order to deploy different types of applications.</p>
</div>
<div class="section" id="https-configuration-for-mybinder-org">
<span id="https-configuration-for-mybinder-org"></span><h2>HTTPS configuration for <code class="docutils literal notranslate"><span class="pre">mybinder.org</span></code><a class="headerlink" href="#https-configuration-for-mybinder-org" title="Permalink to this headline">¶</a></h2>
<p>Using HTTPS requires having a signed certificate. BinderHub uses <a class="reference external" href="https://github.com/jetstack/kube-lego">kube-lego</a>,
a tool that obtains and deploys a free <em>Let’s Encrypt</em> certificate automatically.
This section describes how to use <code class="docutils literal notranslate"><span class="pre">kube-lego</span></code> to configure and deploy HTTPS support.</p>
<p><code class="docutils literal notranslate"><span class="pre">kube-lego</span></code> provides 90 day SSL certificates for <code class="docutils literal notranslate"><span class="pre">mybinder.org</span></code> through
the <a class="reference external" href="https://letsencrypt.org/">letsencrypt</a> service. As the 90
day cycle nears its end, <code class="docutils literal notranslate"><span class="pre">kube-lego</span></code> will automatically request a new
certificate and configure the kubernetes deployment to use it.</p>
<p><code class="docutils literal notranslate"><span class="pre">kube-lego</span></code> is a kubernetes application, with its own Helm Chart that is
referenced in the <a class="reference external" href="https://github.com/jupyterhub/mybinder.org-deploy/blob/5aa6dde60c9b5f3012686f9ba2b23b176c19b224/mybinder/values.yaml#L152"><code class="docutils literal notranslate"><span class="pre">mybinder.org</span></code> Meta Chart</a>. This tells kubernetes which
account to use for letsencrypt certification.</p>
<p>Once we have a letsencrypt account set up, we need to attach the SSL
certificate to a particular <code class="docutils literal notranslate"><span class="pre">ingress</span></code> object. This is a Kubernetes object
that controls how traffic is routed <em>into</em> the deployment. This is also
done with the <code class="docutils literal notranslate"><span class="pre">mybinder.org</span></code> Helm Chart (<a class="reference external" href="https://github.com/jupyterhub/mybinder.org-deploy/blob/5aa6dde60c9b5f3012686f9ba2b23b176c19b224/mybinder/values.yaml#L13">see here for example</a>).</p>
<p>Note that letsencrypt will send you an email if your SSL certificate is
about to expire. If you get such an email, it might mean that the automatic
<code class="docutils literal notranslate"><span class="pre">kube-lego</span></code> renewal process hasn’t worked properly. To debug this, we
recommend running the standard Kubernetes debugging commands with the
<code class="docutils literal notranslate"><span class="pre">kube-lego</span></code> object used with your deployment. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">--</span><span class="n">namespace</span><span class="o">=&lt;</span><span class="n">my</span><span class="o">-</span><span class="n">namespace</span><span class="o">&gt;</span> <span class="n">logs</span> <span class="o">&lt;</span><span class="n">kube</span><span class="o">-</span><span class="n">lego</span><span class="o">-</span><span class="nb">object</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="section" id="exceptions-on-the-ovh-cluster">
<span id="exceptions-on-the-ovh-cluster"></span><h3>Exceptions on the OVH cluster<a class="headerlink" href="#exceptions-on-the-ovh-cluster" title="Permalink to this headline">¶</a></h3>
<p>On the OVH cluster all the binder components use a specific certificate on <code class="docutils literal notranslate"><span class="pre">*.mybinder.ovh</span></code> domain.</p>
<p>Traffic for <code class="docutils literal notranslate"><span class="pre">ovh.mybinder.org</span></code> is redirected with a CNAME on <code class="docutils literal notranslate"><span class="pre">binder.mybinder.ovh</span></code>. That’s why the OVH cluster should be able to serve 2 different certificates.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">*.mybinder.ovh</span></code> certificate is managed by ingresses in the ovh helm configuration.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ovh.mybinder.org</span></code> certificate is managed by a specific ingress and <code class="docutils literal notranslate"><span class="pre">kube-lego</span></code> on the launch of <code class="docutils literal notranslate"><span class="pre">deploy.py</span></code> on the ovh stack.</p></li>
</ul>
</div>
</div>
<div class="section" id="secrets">
<span id="secrets"></span><h2>Secrets<a class="headerlink" href="#secrets" title="Permalink to this headline">¶</a></h2>
<p>Since we use this repo for deployment, it needs credentials for things like our
google cloud account, and secret tokens for our helm charts. Since this is a
public repo, we don’t want these credentials to be readable in public! To solve
this, we use <a class="reference external" href="https://github.com/AGWA/git-crypt">git-crypt</a> to store <em>encrypted</em> versions of files that should
be kept secret. These files are in the <code class="docutils literal notranslate"><span class="pre">secrets</span></code> folder. <code class="docutils literal notranslate"><span class="pre">git-crypt</span></code> uses a
shared secret to encrypt and decrypt files. For automated deployments, Travis
has access to the git-crypt secret in an encrypted environment variable. If you
don’t need to edit the secret files, then you don’t need the git-crypt secret,
or to see the contents of the secret files. When you clone, you will just have
the opaque, encrypted files. If you need access to view or edit the encrypted
files, you will need the git-crypt secret. See below for a procedure to share
the secret. Once you have unlocked the repo with <code class="docutils literal notranslate"><span class="pre">git-crypt</span></code>, you will be able
to view and edit the encrypted files as if they were any other file. <code class="docutils literal notranslate"><span class="pre">git-</span> <span class="pre">crypt</span></code> handles the encryption and decryption transparently via git filters.</p>
<div class="section" id="sharing-secrets">
<span id="sharing-secrets"></span><h3>Sharing secrets<a class="headerlink" href="#sharing-secrets" title="Permalink to this headline">¶</a></h3>
<p>Sharing secrets is tricky! There is a handy tool called <a class="reference external" href="https://github.com/ssh-vault/ssh-vault">ssh-vault</a> which
allows you to securely share information via a mechanism we all have available
here: ssh public keys on GitHub!</p>
<p>To securely share the git-crypt key, both parties should have git-crypt and
ssh-vault. On mac, these are both available from homebrew:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">brew</span> <span class="n">install</span> <span class="n">git</span><span class="o">-</span><span class="n">crypt</span> <span class="n">ssh</span><span class="o">-</span><span class="n">vault</span>
</pre></div>
</div>
<p>To encrypt the key with ssh-vault, pipe the key file through <code class="docutils literal notranslate"><span class="pre">ssh-vault</span> <span class="pre">create</span></code>. Assuming you are in a mybinder.org-deploy directory that is already
setup with git-crypt:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>sender<span class="o">]</span> $ cat .git/git-crypt/keys/default <span class="p">|</span> ssh-vault -u receiver create
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">receiver</span></code> is the recipient’s GitHub username, e.g. <code class="docutils literal notranslate"><span class="pre">willing</span></code> or
<code class="docutils literal notranslate"><span class="pre">choldgraf</span></code>.</p>
<p>The result should look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SSH</span><span class="o">-</span><span class="n">VAULT</span><span class="p">;</span><span class="n">AES256</span><span class="p">;</span><span class="mi">30</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">9</span><span class="n">b</span><span class="p">:</span><span class="n">bd</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="n">f6</span><span class="p">:</span><span class="n">d2</span><span class="p">:</span><span class="mi">1</span><span class="n">d</span><span class="p">:</span><span class="mi">85</span><span class="p">:</span><span class="mi">7</span><span class="n">a</span><span class="p">:</span><span class="n">dc</span><span class="p">:</span><span class="mi">63</span><span class="p">:</span><span class="n">c9</span><span class="p">:</span><span class="n">e6</span><span class="p">:</span><span class="n">ae</span>
<span class="n">LRCe3CrLL</span><span class="o">/</span><span class="n">isMhYVvA5gxZFCLCNyz64EepesTyKYklcMqUBZ1DML1rIXe4KBSudG</span>
<span class="n">D9rbKP1PILGVaTHU2D2aSNJQUGNt3q</span><span class="o">+</span><span class="n">e3G8f5gpPJHvZeM9</span><span class="o">+</span><span class="n">mXKW4I3C8HfjU4sD</span>
<span class="n">EKsm38ShYRAAtO5uTOToSd6j2vdakwEyO2YT7w2PTXiOL0VVeti7i9u</span><span class="o">+</span><span class="n">ENv1sxrg</span>
<span class="n">oyAcN7tYA8Q</span><span class="o">/</span><span class="n">k3</span><span class="o">+</span><span class="n">zRy6ISJD8uEa</span><span class="o">/</span><span class="n">s9Igf99V0o7ocPpjON4oGsaLShuA8w0d3D</span><span class="o">+</span><span class="n">Y</span>
<span class="n">kk0f1iBZ1k</span><span class="o">/</span><span class="mi">0</span><span class="n">QoqPTL8JXjLh9Ba6o8TH6vi8rkZlmBrjDEg5cVlko</span><span class="o">/</span><span class="n">HadSnskQ</span><span class="o">/</span><span class="mi">0</span>
<span class="n">gW5CHn6XP0pIex59V9Tpiw</span><span class="o">==</span><span class="p">;</span><span class="n">dPQUIVgskPrYec3QqRqCrUkoRq1Ig5yOHihQJaS</span>
<span class="n">EoTGNMwI</span><span class="o">=</span>
</pre></div>
</div>
<p>The sender can deliver this encrypted copy to the receiver, via less secure
transport mechanism, such as a gitter private message, SMS, email, etc.</p>
<p>The receiver can now decrypt the message with ssh-vault and use it to unlock
the mybinder.org-deploy repo. Assuming the shared message has been saved to a
file <code class="docutils literal notranslate"><span class="pre">encrypted-key</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>receiver<span class="o">]</span> $ cat encrypted-key <span class="p">|</span> ssh-vault view <span class="p">|</span> git-crypt unlock -
<span class="c1"># remove the encrypted temporary file</span>
<span class="o">[</span>receiver<span class="o">]</span> $ rm encrypted-key
</pre></div>
</div>
<p>If your ssh key requries a passphrase then the above might not work. Below is a
method that works, but creates an intermediate file containing the human-readable
text. Make sure this file is secure and not discoverable by others!
If you have <code class="docutils literal notranslate"><span class="pre">ssh-vault</span></code> &gt;= v0.12.4 you can run the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span><span class="o">-</span><span class="n">vault</span> <span class="o">-</span><span class="n">o</span> <span class="n">clear</span><span class="o">-</span><span class="n">git</span><span class="o">-</span><span class="n">crypt</span><span class="o">-</span><span class="n">key</span> <span class="n">view</span> <span class="n">encrypted</span><span class="o">-</span><span class="n">key</span>
<span class="n">git</span><span class="o">-</span><span class="n">crypt</span> <span class="n">unlock</span> <span class="n">clear</span><span class="o">-</span><span class="n">git</span><span class="o">-</span><span class="n">crypt</span><span class="o">-</span><span class="n">key</span>
<span class="n">rm</span> <span class="n">clear</span><span class="o">-</span><span class="n">git</span><span class="o">-</span><span class="n">crypt</span><span class="o">-</span><span class="n">key</span>
</pre></div>
</div>
<p>This solves the problem that <code class="docutils literal notranslate"><span class="pre">ssh-vault</span></code> prints the passphrase prompt to
standard out as well as the decrypted key. Make sure to delete <code class="docutils literal notranslate"><span class="pre">clear-git-crypt-key</span></code>,
which contains the clear text git-crypt key.</p>
<p>On a mac, you can use <code class="docutils literal notranslate"><span class="pre">pbcopy</span></code> and <code class="docutils literal notranslate"><span class="pre">pbpaste</span></code> to use the clipboard instead of
creating files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>sender<span class="o">]</span> $ cat .git/git-crypt/keys/default <span class="p">|</span> ssh-vault -u receiver create <span class="p">|</span> pbcopy
<span class="c1"># the encrypted message is in sender&#39;s clipboard</span>
<span class="c1"># deliver it to the receiver, and once it is in their clipboard:</span>
<span class="o">[</span>receiver<span class="o">]</span> $ pbpaste <span class="p">|</span> ssh-vault view <span class="p">|</span> git-crypt unlock -
</pre></div>
</div>
</div>
<div class="section" id="who-has-the-keys">
<span id="who-has-the-keys"></span><h3>Who has the keys?<a class="headerlink" href="#who-has-the-keys" title="Permalink to this headline">¶</a></h3>
<p>People who currently have the git-crypt secret include:</p>
<ul class="simple">
<li><p>&#64;minrk</p></li>
<li><p>&#64;yuvipanda</p></li>
<li><p>&#64;betatim</p></li>
<li><p>&#64;choldgraf</p></li>
<li><p>&#64;mael-le-gal</p></li>
<li><p>&#64;sgibson91</p></li>
<li><p><em>add yourself here if you have it</em></p></li>
</ul>
<p>Contact one of them if you need access to the git-crypt key.</p>
</div>
</div>
</div>


          </div>
   <div class='prev-next-bottom'>
     
      <a class='left-prev' href="getting_started.html" title="previous chapter">Getting started with the <code class="docutils literal notranslate"><span class="pre">mybinder.org</span></code> dev team</a>
      <a class='right-next' href="terminology.html" title="next chapter">Terminology for the deployment</a>
   <div style='clear:both;'></div>
 
   </div>

        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <p class="logo"><a href="index.html">
    <img class="logo" src="_static/logo.jpg" alt="Logo"/>
  </a></p>
<h1 class="logo"><a href="index.html">Site Reliability Guide for mybinder.org</a></h1>



<p class="blurb">A Site Reliability Guide for mybinder.org deployment</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jupyterhub&repo=binderhub&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<h3>Table of Contents</h3>
<p class="caption"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started with the <code class="docutils literal notranslate"><span class="pre">mybinder.org</span></code> dev team</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Production environment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#repository-structure">Repository structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dependent-charts">Dependent charts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-values">Configuration values</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deployment-nodes-and-pools">Deployment nodes and pools</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mybinder-org-specific-extra-software">mybinder.org specific extra software</a></li>
<li class="toctree-l2"><a class="reference internal" href="#related-repositories">Related repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-deployment-helm-meta-chart">The Deployment Helm Meta Chart</a></li>
<li class="toctree-l2"><a class="reference internal" href="#https-configuration-for-mybinder-org">HTTPS configuration for <code class="docutils literal notranslate"><span class="pre">mybinder.org</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#secrets">Secrets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="terminology.html">Terminology for the deployment</a></li>
</ul>
<p class="caption"><span class="caption-text">Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="deployment/prereqs.html">Pre-requisite technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment/how.html">How to deploy a change to mybinder.org?</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment/what.html">What does a MyBinder.org deployment do?</a></li>
</ul>
<p class="caption"><span class="caption-text">Operation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common_problems.html">Common problems and their solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_snippets.html">Command snippets used during operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="grafana_plots.html">Some useful Grafana plots</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="components/metrics.html">Metrics collection with Prometheus</a></li>
<li class="toctree-l1"><a class="reference internal" href="components/dashboards.html">Operational Dashboards with Grafana</a></li>
<li class="toctree-l1"><a class="reference internal" href="components/ingress.html">HTTPS ingress with nginx + kube-lego</a></li>
<li class="toctree-l1"><a class="reference internal" href="components/cloud.html">Cloud products</a></li>
<li class="toctree-l1"><a class="reference internal" href="components/matomo.html">Matomo (formerly Piwik) analytics</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="analytics/events-archive.html">The Analytics Events Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="analytics/cloud-costs.html">Cloud Costs Data</a></li>
</ul>
<p class="caption"><span class="caption-text">Incidents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2019-04-03-ingress-cordoned.html">2019-04-03, 30min outage during node pool upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2019-03-24-r2d-upgrade.html">2019-03-24, repo2docker upgrade and docker image cache wipe</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2019-02-20-no-logs.html">incident date: 2019-02-20, kubectl logs unavailable</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2018-07-30-jupyterlab-build-cpu-saturate.html">2018-07-30 JupyterLab builds saturate BinderHub CPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2018-07-08-podsnips-aplenty.html">2018-07-08, too many pods</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2018-04-18-cull-flood.html">2018-04-18, Culler flood</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2018-03-31-server-start-fail.html">2018-03-31, Server launch failures</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2018-03-26-no-space-left.html">2018-03-26, “no space left on device”</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2018-03-13-PVC-hub-locked.html">2018-03-13, PVC for hub is locked</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2018-02-22-nginx-down.html">2018-02-22 NGINX crash</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2018-02-20-jupyterlab-announcement.html">2018-02-20, JupyterLab Announcement swamps Binder</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2018-02-12-launch-fail.html">2018-02-12, Hub Launch Fail</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2018-01-18-reddit-hug.html">2018-01-18, reddit hugs mybinder</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2018-01-18-ssl-outdated.html">2018-01-11, Warning from letsencrypt about outdated SSL certificate</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2018-01-17-ubuntu-upgrade.html">2018-01-17, Emergency Aardvark bump</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2018-01-04-failed-staging-deploy.html">2018-01-04, Failed deploy to staging</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2017-11-30-oom-proxy.html">2017-11-30 4:23PM PST, OOM (Out of Memory) Proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2017-10-17-cluster-full.html">2017-10-17, Cluster Full</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2017-09-29-504.html">2017-09-29, 504</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/2017-09-27-hub-403.html">2017-09-27, Hub 403</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/template-incident-report.html">Template for reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident-reports/template-incident-report.html#incident-date-yyyy-mm-dd-incident-name">{{ incident date: yyyy-mm-dd }}, {{ incident name }}</a></li>
</ul>


<div class="relations">
<h3>Navigation</h3>
<ul>
  <li><a href="index.html">Documentation Home</a><ul>
  <li><a href="getting_started.html" title="Previous">Previous topic</a></li>
  <li><a href="terminology.html" title="Next">Next topic</a></li>
  </ul>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/production_environment.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
        <form class="search" action="search.html" method="get">
            <input type="text" name="q" placeholder="Quick Search" aria-labelledby="searchlabel" />
            <input type="submit" value="Go" />
        </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017 - 2019, Binder Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/production_environment.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>